statement ok
fs:= inspect.getEnvironment("mapi_port")

statement ok
port:= calc.int(fs)

statement ok
hs:= "localhost"

statement ok
usr := "monetdb"

statement ok
pwd := "monetdb"

statement ok
lang := "mal"

statement ok
mid:= mapi.connect(hs,port,usr,pwd,lang)

query T rowsort
io.print(mid)
----
1

statement ok
mapi.query(mid, "t:= 1+3; io.print(t,\"hello\");");

statement ok
i:= mapi.get_row_count(mid)

query T rowsort
io.printf("rowcount %d\n",i)
----
rowcount 1

statement ok
mapi.fetch_row(mid)

statement ok
fcnt:= mapi.get_field_count(mid)

query T rowsort
io.printf("fieldcount %d\n",fcnt)
----
fieldcount 2

statement ok
fi:int:= mapi.fetch_field(mid,0)

query T rowsort
io.printf("field 0 %d\n",fi)
----
field 0 4

statement ok
s:str:= mapi.fetch_field(mid,1)

query T rowsort
io.printf("field 1 %s\n",s)
----
field 1 hello

statement error
mapi.query(mid,"r:= bat.new(:int);")

query T rowsort
io.printf("shipped first query\n")
----
shipped first query

statement error
mapi.query(mid,"bat.append(r,311);")

statement error
mapi.query(mid,"bat.append(r,433);")

statement error
b:bat[:int]:= mapi.rpc(mid,"io.print(r);")

statement error
io.print(b)

statement error
msg:str := mapi.rpc(mid,"io.print(\"hello world\");")

statement error
io.print(msg)

statement error
o:oid := mapi.rpc(mid,"io.print(34@0);")

statement error
io.print(o)

statement error
o:oid := mapi.rpc(mid,"io.print(nil:oid);")

statement error
io.print(o)

statement ok
catch MapiException:str

statement ok
	io.printf("foutje:%s\n",MapiException)

statement ok
exit MapiException

statement ok
mapi.disconnect(mid)

