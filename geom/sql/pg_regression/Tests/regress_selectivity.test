statement ok
create table no_stats ( g geometry, id integer )

statement ok
create table no_stats_join ( g geometry, id integer )

statement error
select _postgis_selectivity('no_stats','g', 'LINESTRING(0 0, 1 1)')

statement error
select _postgis_stats('no_stats','g')

statement error
select _postgis_join_selectivity('no_stats', 'g', 'no_stats_join', 'g')

statement ok
insert into no_stats (g, id) values ('POINT(0 0)', 0)

statement error
analyze no_stats

statement error
select _postgis_join_selectivity('no_stats', 'g', 'no_stats_join', 'g')

statement ok
drop table no_stats

statement ok
drop table no_stats_join

statement error
create table regular_overdots as
with
ij as ( select i, j from generate_series(1, 10) i, generate_series(1, 10) j),
iijj as (select generate_series(1, i) as a, generate_series(1, j) b from ij)
select st_makepoint(a, b) as g from iijj

statement error
analyze regular_overdots

statement error
select 'selectivity_00', count(*) from regular_overdots

statement error
select 'selectivity_01', count(*) from regular_overdots where g && 'LINESTRING(0 0, 11 3.5)'

query TTR rowsort
select 'selectivity_02', 'actual', round(1068.0/2127.0,3)
----
selectivity_02
actual
0.502

statement error
select 'selectivity_03', 'estimated', round(_postgis_selectivity('regular_overdots','g','LINESTRING(0 0, 11 3.5)')::numeric,3)

statement error
select 'selectivity_04', count(*) from regular_overdots where g && 'LINESTRING(5.5 5.5, 11 11)'

query TTR rowsort
select 'selectivity_05', 'actual', round(161.0/2127.0,3)
----
selectivity_05
actual
0.075

statement error
select 'selectivity_06', 'estimated', round(_postgis_selectivity('regular_overdots','g','LINESTRING(5.5 5.5, 11 11)')::numeric,3)

statement error
select 'selectivity_07', count(*) from regular_overdots where g && 'LINESTRING(1.5 1.5, 2.5 2.5)'

query TTR rowsort
select 'selectivity_08', 'actual', round(81.0/2127.0,3)
----
selectivity_08
actual
0.038

statement error
select 'selectivity_09', 'estimated', round(_postgis_selectivity('regular_overdots','g','LINESTRING(1.5 1.5, 2.5 2.5)')::numeric,3)

query TTI rowsort
select 'selectivity_10', 'actual', 0
----
selectivity_10
actual
0

statement error
select 'selectivity_09', 'estimated', _postgis_selectivity('regular_overdots','g','LINESTRING(11 11, 12 12)')

query TTI rowsort
select 'selectivity_10', 'actual', 1
----
selectivity_10
actual
1

statement error
select 'selectivity_09', 'estimated', _postgis_selectivity('regular_overdots','g','LINESTRING(0 0, 12 12)')

statement ok
drop table if exists regular_overdots


