statement ok
CREATE TABLE sampleData ( groupID int, numValue int )

statement ok
INSERT INTO sampleData VALUES ( 1,   1 )

statement ok
INSERT INTO sampleData VALUES ( 1,   2 )

statement ok
INSERT INTO sampleData VALUES ( 1,   6 )

statement ok
INSERT INTO sampleData VALUES ( 1,  16 )

statement ok
INSERT INTO sampleData VALUES ( 1,   7 )

statement ok
INSERT INTO sampleData VALUES ( 2,   5 )

statement ok
INSERT INTO sampleData VALUES ( 2,   5 )

statement ok
INSERT INTO sampleData VALUES ( 2,   5 )

statement ok
INSERT INTO sampleData VALUES ( 2,  11 )

statement ok
INSERT INTO sampleData VALUES ( 3,  10 )

statement ok
INSERT INTO sampleData VALUES ( 3,  17 )

statement ok
INSERT INTO sampleData VALUES ( 3,  52 )

statement ok
INSERT INTO sampleData VALUES ( 3,  66 )

statement ok
INSERT INTO sampleData VALUES ( 4,  18 )

statement ok
INSERT INTO sampleData VALUES ( 5,   0 )

statement ok
INSERT INTO sampleData VALUES ( 5,   0 )

statement ok
INSERT INTO sampleData VALUES ( 5,   0 )

query I rowsort
SELECT count(*) from sampleData
----
17

query I rowsort
SELECT median(numValue) FROM sampleData
----
6

query I rowsort
SELECT median(groupID) FROM sampleData
----
2

query II rowsort
SELECT groupID, median(numValue) FROM sampleData GROUP BY groupID ORDER BY groupId
----
10 values hashing to 0da73ad67a2902b543b497619b249c51

query IR rowsort
SELECT R.groupID, CAST(AVG(1.0*R.numValue) AS DECIMAL(10,2)) AS medianValue
FROM
(    SELECT GroupID, numValue, ROW_NUMBER() OVER(PARTITION BY groupID ORDER BY NumValue) AS rowno
    FROM sampleData
) R
INNER JOIN
(    SELECT GroupID, 1+count(*) as N
    FROM sampleData
    GROUP BY GroupID
) G
ON R.GroupID = G.GroupID AND R.rowNo BETWEEN N/2 AND N/2+N%2
GROUP BY R.groupID ORDER by R.groupID
----
10 values hashing to 663c20a5da1829cdf01fa426a6e7bbcb

query IR rowsort
SELECT R.groupID, sqrt(SUM((R.n-G.a)*(R.n-G.a))/count(*)) AS stdev
FROM
(    SELECT GroupID, NumValue as n
    FROM sampleData
) R
INNER JOIN
(    SELECT GroupID, AVG(numValue) as a
    FROM sampleData
    GROUP BY GroupID
) G
ON R.GroupID = G.GroupID
GROUP BY R.groupID ORDER BY R.groupID
----
10 values hashing to 29655407b4de71a4b7c712dac14fab1e

statement ok
drop table sampleData

