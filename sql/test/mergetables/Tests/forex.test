statement ok
CREATE TABLE day1 ( clk timestamp, currency string, ts timestamp, bid decimal(12,6), offer decimal(12,6), spread decimal(12,6) )

statement ok
CREATE TABLE day1stage ( clk bigint, currency string, ts bigint, bid decimal(12,6), offer decimal(12,6), spread decimal(12,6) )

statement ok
COPY 10 RECORDS INTO day1stage FROM STDIN USING DELIMITERS '|',E'\n'
<COPY_INTO_DATA>
1413267171000|EUR/USD|1413267158643|1.271810|1.271890|0.000080
1413267171000|USD/JPY|1413267171225|107.121000|107.127000|0.006000
1413267171000|GBP/USD|1413267161304|1.606820|1.606930|0.000110
1413267171000|EUR/GBP|1413267150417|0.791460|0.791570|0.000110
1413267171000|USD/CHF|1413267158643|0.950420|0.950550|0.000130
1413267171000|EUR/JPY|1413267171318|136.240000|136.253000|0.013000
1413267171000|EUR/CHF|1413267158643|1.208760|1.208950|0.000190
1413267171000|USD/CAD|1413267171318|1.121180|1.121270|0.000090
1413267171000|AUD/USD|1413267162803|0.878680|0.878780|0.000100
1413267171000|GBP/JPY|1413267171239|172.126000|172.146000|0.020000

query ITIRRR rowsort
SELECT * FROM day1stage
----
60 values hashing to 0d8e02cf7f8982396f24be12a70f0eb6

statement ok
INSERT INTO day1
SELECT epoch(clk), currency, epoch(ts), bid, offer,spread
FROM day1stage

statement ok
DROP TABLE day1stage

query TTTRRR rowsort
SELECT * from day1
----
60 values hashing to 874b845900b723649be705781820d11c

statement ok
ALTER TABLE day1 SET READ ONLY

statement ok
CREATE TABLE day2 ( clk timestamp, currency string, ts timestamp, bid decimal(12,6), offer decimal(12,6), spread decimal(12,6) )

statement ok
CREATE TABLE day2stage ( clk bigint, currency string, ts bigint, bid decimal(12,6), offer decimal(12,6), spread decimal(12,6) )

statement ok
COPY 10 RECORDS INTO day2stage FROM STDIN USING DELIMITERS '|',E'\n'
<COPY_INTO_DATA>
1413267176000|EUR/USD|1413267177168|1.271780|1.271880|0.000100
1413267176000|USD/JPY|1413267177168|107.120000|107.125000|0.005000
1413267176000|GBP/USD|1413267175356|1.606820|1.606950|0.000130
1413267176000|EUR/GBP|1413267175336|0.791440|0.791550|0.000110
1413267176000|USD/CHF|1413267175367|0.950430|0.950560|0.000130
1413267176000|EUR/JPY|1413267177033|136.235000|136.248000|0.013000
1413267176000|EUR/CHF|1413267158643|1.208760|1.208950|0.000190
1413267176000|USD/CAD|1413267173063|1.121150|1.121260|0.000110
1413267176000|AUD/USD|1413267176076|0.878680|0.878760|0.000080
1413267176000|GBP/JPY|1413267176950|172.122000|172.142000|0.020000

statement ok
INSERT INTO day2
SELECT epoch(clk), currency, epoch(ts), bid, offer,spread
FROM day2stage

statement ok
DROP TABLE day2stage

query TTTRRR rowsort
SELECT * from day2
----
60 values hashing to 219f0a75aa3974292c5907803e9046ec

statement ok
ALTER TABLE day2 SET READ ONLY

statement ok
CREATE TABLE day3 ( clk timestamp, currency string, ts timestamp, bid decimal(12,6), offer decimal(12,6), spread decimal(12,6) )

statement ok
INSERT INTO day3 VALUES( epoch(1413267181000), 'EUR/USD', epoch(1413267182327), 1.271910, 1.271990, 0.000080)

statement ok
INSERT INTO day3 VALUES( epoch(1413267181000), 'USD/JPY', epoch(1413267181647), 107.114000,107.121000,0.007000)

statement ok
INSERT INTO day3 VALUES( epoch(1413267181000), 'GBP/USD', epoch(1413267182048), 1.606870, 1.606980, 0.000110)

statement ok
INSERT INTO day3 VALUES( epoch(1413267181000), 'EUR/GBP', epoch(1413267181968), 0.791490, 0.791600, 0.000110)

statement ok
INSERT INTO day3 VALUES( epoch(1413267181000), 'USD/CHF', epoch(1413267182041), 0.950350, 0.950460, 0.000110)

statement ok
INSERT INTO day3 VALUES( epoch(1413267181000), 'EUR/JPY', epoch(1413267182406), 136.241000,136.253000,0.012000)

statement ok
INSERT INTO day3 VALUES( epoch(1413267181000), 'EUR/CHF', epoch(1413267181950), 1.208770, 1.208950, 0.000180)

statement ok
INSERT INTO day3 VALUES( epoch(1413267181000), 'USD/CAD', epoch(1413267181830), 1.121120, 1.121230, 0.000110)

statement ok
INSERT INTO day3 VALUES( epoch(1413267181000), 'AUD/USD', epoch(1413267181549), 0.878730, 0.878810, 0.000080)

statement ok
INSERT INTO day3 VALUES( epoch(1413267181000), 'GBP/JPY', epoch(1413267181618), 172.116000,172.138000,0.022000)

query TTTRRR rowsort
SELECT * from day3
----
60 values hashing to 5a761f0f19818bf0d394b61b3b0bf8a5

statement ok
ALTER TABLE day3 SET READ ONLY

statement ok
CREATE MERGE TABLE forex ( clk timestamp, currency string, ts timestamp, bid decimal(12,6), offer decimal(12,6), spread decimal(12,6) )

statement ok
ALTER TABLE forex ADD TABLE day1

statement ok
ALTER TABLE forex ADD TABLE day2

statement ok
ALTER TABLE forex ADD TABLE day3

query TTTRRR rowsort
SELECT * FROM forex WHERE currency = 'EUR/USD'
----
18 values hashing to 1c506cabe07d505cfc6879c8dc167d77

query RR rowsort
SELECT avg(bid), cast(sum(bid) AS DECIMAL(12,6)) FROM forex
----
42.331
1269.922

query TRR rowsort
SELECT currency, cast(avg(bid) AS DECIMAL(12,6)), cast(sum(bid) AS DECIMAL(12,6)) FROM forex GROUP BY currency
----
30 values hashing to 6327a9880ccacdc3ec95eaefa14de751

statement ok
ALTER TABLE forex DROP TABLE day1

query TTTRRR rowsort
SELECT * FROM forex WHERE currency = 'EUR/USD'
----
12 values hashing to 9ef39c09ff4f158f55de074bc3a8077b

statement ok
DROP TABLE forex

statement ok
DROP TABLE day1

statement ok
DROP TABLE day2

statement ok
DROP TABLE day3


